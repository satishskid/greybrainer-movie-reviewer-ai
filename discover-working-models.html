<!DOCTYPE html>
<html>
<head>
    <title>Discover Working Gemini Models</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 900px; margin: 0 auto; }
        input { background: #333; color: #fff; padding: 10px; width: 400px; border: 1px solid #555; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #1a4d1a; border: 1px solid #2d7d2d; }
        .error { background: #4d1a1a; border: 1px solid #7d2d2d; }
        .info { background: #1a1a4d; border: 1px solid #2d2d7d; }
        .model-list { background: #2a2a2a; padding: 15px; border-radius: 5px; margin: 10px 0; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Discover Working Gemini Models</h1>
        <p>This tool will call the Google API to find all available models and test which ones actually work.</p>
        
        <div>
            <input type="password" id="apiKey" placeholder="Enter your Gemini API key" />
            <button onclick="discoverAndTestModels()">üöÄ Discover & Test All Models</button>
            <button onclick="listModelsOnly()">üìã List Available Models Only</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        async function listModelsOnly() {
            const apiKey = document.getElementById('apiKey').value;
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = '<div class="result error">Please enter your API key</div>';
                return;
            }
            
            try {
                resultsDiv.innerHTML = '<div class="result info">üîç Fetching available models from Google API...</div>';
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                const data = await response.json();
                
                if (response.ok && data.models) {
                    const allModels = data.models.map(model => ({
                        name: model.name,
                        displayName: model.displayName,
                        supportedMethods: model.supportedGenerationMethods || []
                    }));
                    
                    const generateContentModels = allModels.filter(model => 
                        model.supportedMethods.includes('generateContent')
                    );
                    
                    resultsDiv.innerHTML = `
                        <div class="result success">
                            <h3>üìã Available Models from Google API</h3>
                            <p><strong>Total Models:</strong> ${allModels.length}</p>
                            <p><strong>Models Supporting generateContent:</strong> ${generateContentModels.length}</p>
                        </div>
                        
                        <div class="model-list">
                            <h4>‚úÖ Models that support generateContent:</h4>
                            ${generateContentModels.map(model => `
                                <div style="margin: 5px 0; padding: 5px; background: #1a4d1a; border-radius: 3px;">
                                    <strong>${model.name}</strong><br>
                                    <small>Display Name: ${model.displayName || 'N/A'}</small><br>
                                    <small>Methods: ${model.supportedMethods.join(', ')}</small>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="model-list">
                            <h4>‚ùå Other Models (don't support generateContent):</h4>
                            ${allModels.filter(m => !m.supportedMethods.includes('generateContent')).map(model => `
                                <div style="margin: 5px 0; padding: 5px; background: #4d1a1a; border-radius: 3px;">
                                    <strong>${model.name}</strong><br>
                                    <small>Display Name: ${model.displayName || 'N/A'}</small><br>
                                    <small>Methods: ${model.supportedMethods.join(', ')}</small>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `<div class="result error">‚ùå API Error: ${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function testModelGeneration(apiKey, modelName) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: 'Say "test" and nothing else.'
                            }]
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No text response';
                    return { success: true, response: text.trim() };
                } else {
                    const errorText = await response.text();
                    return { success: false, error: `${response.status}: ${errorText}` };
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function discoverAndTestModels() {
            const apiKey = document.getElementById('apiKey').value;
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = '<div class="result error">Please enter your API key</div>';
                return;
            }
            
            try {
                resultsDiv.innerHTML = '<div class="result info">üîç Step 1: Discovering available models...</div>';
                
                // First, get all available models
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                const data = await response.json();
                
                if (!response.ok || !data.models) {
                    resultsDiv.innerHTML = `<div class="result error">‚ùå Failed to fetch models: ${JSON.stringify(data, null, 2)}</div>`;
                    return;
                }
                
                const generateContentModels = data.models.filter(model => 
                    model.supportedGenerationMethods?.includes('generateContent')
                );
                
                resultsDiv.innerHTML += `
                    <div class="result success">
                        ‚úÖ Found ${generateContentModels.length} models that support generateContent
                    </div>
                    <div class="result info">üß™ Step 2: Testing each model...</div>
                `;
                
                const workingModels = [];
                const brokenModels = [];
                
                for (const model of generateContentModels) {
                    const modelName = model.name;
                    const displayName = model.displayName || modelName;
                    
                    resultsDiv.innerHTML += `<div class="result info">Testing: ${modelName}...</div>`;
                    
                    const testResult = await testModelGeneration(apiKey, modelName);
                    
                    if (testResult.success) {
                        workingModels.push({ name: modelName, displayName, response: testResult.response });
                        resultsDiv.innerHTML += `<div class="result success">‚úÖ ${modelName}: WORKS! Response: "${testResult.response}"</div>`;
                    } else {
                        brokenModels.push({ name: modelName, displayName, error: testResult.error });
                        resultsDiv.innerHTML += `<div class="result error">‚ùå ${modelName}: ${testResult.error}</div>`;
                    }
                    
                    // Small delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                
                // Final summary with configuration
                resultsDiv.innerHTML += `
                    <div class="model-list">
                        <h2>üéâ FINAL RESULTS</h2>
                        
                        <h3>‚úÖ Working Models (${workingModels.length}):</h3>
                        ${workingModels.map(model => `
                            <div style="margin: 5px 0; padding: 8px; background: #1a4d1a; border-radius: 5px;">
                                <strong>${model.name}</strong><br>
                                <small>Display: ${model.displayName}</small><br>
                                <small>Test Response: "${model.response}"</small>
                            </div>
                        `).join('')}
                        
                        <h3>‚ùå Broken Models (${brokenModels.length}):</h3>
                        ${brokenModels.map(model => `
                            <div style="margin: 5px 0; padding: 8px; background: #4d1a1a; border-radius: 5px;">
                                <strong>${model.name}</strong><br>
                                <small>Error: ${model.error}</small>
                            </div>
                        `).join('')}
                        
                        ${workingModels.length > 0 ? `
                            <h3>üîß Updated Configuration for config/gemini-models.json:</h3>
                            <pre>{
  "defaultModels": {
    "preferred": "${workingModels[0].name.replace('models/', '')}",
    "fallback": "${workingModels[1]?.name.replace('models/', '') || workingModels[0].name.replace('models/', '')}",
    "legacy": "${workingModels[0].name.replace('models/', '')}"
  }
}</pre>
                        ` : `
                            <div class="result error">
                                <h3>üö® NO WORKING MODELS FOUND</h3>
                                <p>This suggests an issue with your API key or the Gemini API itself.</p>
                            </div>
                        `}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">‚ùå Discovery failed: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>