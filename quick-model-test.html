<!DOCTYPE html>
<html>
<head>
    <title>Quick Model Test</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        input { background: #333; color: #fff; padding: 10px; width: 400px; }
        button { background: #0a0; color: #000; padding: 10px; margin: 10px; }
        .result { margin: 10px 0; padding: 10px; background: #111; border-left: 4px solid #0a0; }
        .error { border-left-color: #a00; }
    </style>
</head>
<body>
    <h1>‚ö° Quick Model Test</h1>
    <input type="password" id="apiKey" placeholder="Enter Gemini API Key" />
    <button onclick="quickTest()">üöÄ Quick Test</button>
    <div id="output"></div>

    <script>
        async function quickTest() {
            const apiKey = document.getElementById('apiKey').value;
            const output = document.getElementById('output');
            
            if (!apiKey) {
                output.innerHTML = '<div class="result error">Please enter API key</div>';
                return;
            }
            
            output.innerHTML = '<div class="result">üîç Step 1: Listing all available models...</div>';
            
            try {
                // Step 1: List all models
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                const data = await response.json();
                
                if (response.ok && data.models) {
                    const generateModels = data.models.filter(m => 
                        m.supportedGenerationMethods?.includes('generateContent')
                    );
                    
                    output.innerHTML += `
                        <div class="result">
                            ‚úÖ Found ${generateModels.length} models that support generateContent:<br>
                            ${generateModels.map(m => `‚Ä¢ ${m.name} (${m.displayName || 'No display name'})`).join('<br>')}
                        </div>
                    `;
                    
                    // Step 2: Test the first few models
                    output.innerHTML += '<div class="result">üß™ Step 2: Testing first 3 models...</div>';
                    
                    for (let i = 0; i < Math.min(3, generateModels.length); i++) {
                        const model = generateModels[i];
                        const modelName = model.name;
                        
                        try {
                            output.innerHTML += `<div class="result">Testing ${modelName}...</div>`;
                            
                            const testResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${apiKey}`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    contents: [{ parts: [{ text: 'Say "hello" and nothing else.' }] }]
                                })
                            });
                            
                            if (testResponse.ok) {
                                const testData = await testResponse.json();
                                const text = testData.candidates?.[0]?.content?.parts?.[0]?.text || 'No text';
                                output.innerHTML += `<div class="result">‚úÖ ${modelName}: WORKS! Response: "${text.trim()}"</div>`;
                                
                                // If this is the first working model, show config
                                if (i === 0) {
                                    const configModelName = modelName.replace('models/', '');
                                    output.innerHTML += `
                                        <div class="result">
                                            üîß <strong>USE THIS MODEL:</strong><br>
                                            Update your config to use: <strong>${configModelName}</strong><br>
                                            <br>
                                            In config/gemini-models.json, set:<br>
                                            "preferred": "${configModelName}"
                                        </div>
                                    `;
                                }
                            } else {
                                const errorText = await testResponse.text();
                                output.innerHTML += `<div class="result error">‚ùå ${modelName}: ${testResponse.status} - ${errorText}</div>`;
                            }
                        } catch (error) {
                            output.innerHTML += `<div class="result error">‚ùå ${modelName}: ${error.message}</div>`;
                        }
                        
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                } else {
                    output.innerHTML += `<div class="result error">‚ùå Failed to list models: ${JSON.stringify(data, null, 2)}</div>`;
                }
            } catch (error) {
                output.innerHTML += `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>