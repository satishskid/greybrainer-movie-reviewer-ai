<!DOCTYPE html>
<html>
<head>
    <title>Test Gemini 2.5 Flash</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 800px; margin: 0 auto; }
        input { background: #333; color: #fff; padding: 10px; width: 400px; border: 1px solid #555; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #1a4d1a; border: 1px solid #2d7d2d; }
        .error { background: #4d1a1a; border: 1px solid #7d2d2d; }
        .info { background: #1a1a4d; border: 1px solid #2d2d7d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Gemini 2.5 Flash Model</h1>
        <p>This tool tests the new gemini-2.5-flash model that should work with the current API.</p>
        
        <div>
            <input type="password" id="apiKey" placeholder="Enter your Gemini API key" />
            <button onclick="testGemini25Flash()">Test gemini-2.5-flash</button>
            <button onclick="testBothLibraries()">Test Both Libraries</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script type="module">
        // Test using the same approach as the working example
        async function testWithGoogleGenAI(apiKey) {
            try {
                const { GoogleGenAI } = await import('https://aistudiocdn.com/@google/genai@^1.28.0');
                const ai = new GoogleGenAI({ apiKey });
                const response = await ai.models.generateContent({ 
                    model: 'gemini-2.5-flash', 
                    contents: 'Say "test successful" and nothing else.' 
                });
                return { success: true, response: response.text, library: '@google/genai' };
            } catch (error) {
                return { success: false, error: error.message, library: '@google/genai' };
            }
        }

        // Test using the old library approach
        async function testWithGenerativeAI(apiKey) {
            try {
                const { GoogleGenerativeAI } = await import('https://esm.sh/@google/generative-ai@0.21.0');
                const genAI = new GoogleGenerativeAI(apiKey);
                const model = genAI.getGenerativeModel({ model: 'gemini-2.5-flash' });
                const result = await model.generateContent('Say "test successful" and nothing else.');
                const response = await result.response;
                const text = response.text();
                return { success: true, response: text, library: '@google/generative-ai' };
            } catch (error) {
                return { success: false, error: error.message, library: '@google/generative-ai' };
            }
        }

        window.testGemini25Flash = async function() {
            const apiKey = document.getElementById('apiKey').value;
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = '<div class="result error">Please enter your API key</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div class="result info">üß™ Testing gemini-2.5-flash with @google/genai library...</div>';
            
            const result = await testWithGoogleGenAI(apiKey);
            
            if (result.success) {
                resultsDiv.innerHTML += `
                    <div class="result success">
                        ‚úÖ <strong>gemini-2.5-flash WORKS!</strong><br>
                        Library: ${result.library}<br>
                        Response: "${result.response}"<br>
                        <br>
                        üéâ <strong>This model should work in your Greybrainer app!</strong>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå <strong>gemini-2.5-flash FAILED</strong><br>
                        Library: ${result.library}<br>
                        Error: ${result.error}
                    </div>
                `;
            }
        };

        window.testBothLibraries = async function() {
            const apiKey = document.getElementById('apiKey').value;
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = '<div class="result error">Please enter your API key</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div class="result info">üß™ Testing gemini-2.5-flash with both libraries...</div>';
            
            // Test with new library
            const newLibResult = await testWithGoogleGenAI(apiKey);
            
            if (newLibResult.success) {
                resultsDiv.innerHTML += `
                    <div class="result success">
                        ‚úÖ <strong>@google/genai (NEW):</strong> WORKS!<br>
                        Response: "${newLibResult.response}"
                    </div>
                `;
            } else {
                resultsDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå <strong>@google/genai (NEW):</strong> ${newLibResult.error}
                    </div>
                `;
            }
            
            // Test with old library
            resultsDiv.innerHTML += '<div class="result info">Testing with old library...</div>';
            const oldLibResult = await testWithGenerativeAI(apiKey);
            
            if (oldLibResult.success) {
                resultsDiv.innerHTML += `
                    <div class="result success">
                        ‚úÖ <strong>@google/generative-ai (OLD):</strong> WORKS!<br>
                        Response: "${oldLibResult.response}"
                    </div>
                `;
            } else {
                resultsDiv.innerHTML += `
                    <div class="result error">
                        ‚ùå <strong>@google/generative-ai (OLD):</strong> ${oldLibResult.error}
                    </div>
                `;
            }
            
            // Summary
            if (newLibResult.success || oldLibResult.success) {
                resultsDiv.innerHTML += `
                    <div class="result success">
                        <h3>üéâ SOLUTION FOUND!</h3>
                        <p><strong>gemini-2.5-flash</strong> works with ${newLibResult.success ? 'the new' : 'the old'} library.</p>
                        <p>Your Greybrainer app configuration has been updated to use this model.</p>
                        <p><strong>Next steps:</strong></p>
                        <ol>
                            <li>Clear your browser cache</li>
                            <li>Restart your Greybrainer application</li>
                            <li>Test the film analysis features</li>
                        </ol>
                    </div>
                `;
            } else {
                resultsDiv.innerHTML += `
                    <div class="result error">
                        <h3>üö® BOTH LIBRARIES FAILED</h3>
                        <p>Neither library could use gemini-2.5-flash. This suggests:</p>
                        <ul>
                            <li>API key issue</li>
                            <li>Model name still incorrect</li>
                            <li>Need to use model discovery tool</li>
                        </ul>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>